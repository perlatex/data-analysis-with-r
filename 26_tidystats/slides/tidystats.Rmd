---
title: "`tidystats`: T æ£€éªŒä¸æ–¹å·®åˆ†æ"
subtitle: "ç»´ç”Ÿç´ æ‘„å…¥æ–¹æ³•å’Œå‰‚é‡å¯¹è±šé¼ ç‰™é½¿ç”Ÿé•¿çš„å½±å“"
author: "ç‹æ•æ°"
institute: "å››å·å¸ˆèŒƒå¤§å­¦"
date: "`r Sys.Date()`"
output:
  xaringan::moon_reader:
    lib_dir: libs
    css: ["default", "metropolis", "hygge", "ggstatsplot_presentation.css"]
    nature:
      ratio: 16:9
      highlightStyle: "foundation"
      highlightLines: true
      countIncrementalSlides: false
      #slideNumberFormat: "%current%"
editor_options: 
  chunk_output_type: console
---




```{r, include = F}
# This is the recommended set up for flipbooks
# you might think about setting cache to TRUE as you gain practice --- building flipbooks from scratch can be time consuming
knitr::opts_chunk$set(
  fig.width = 7, 
  fig.height = 5,
  fig.retina = 2,
  fig.align = "center",
  out.width = "100%",
  dpi = 300,
  message = FALSE, 
  warning = FALSE, 
  comment = "", 
  cache = F
  )
library(flipbookr)
library(tidyverse)
```

```{r setup, include=FALSE}
knitr::opts_hooks$set(fig.callout = function(options) {
  if (options$fig.callout) {
    options$echo <- FALSE
    options$out.height <- "99%"
    options$fig.width <- 16
    options$fig.height <- 8
  }
  options
})

options(
  htmltools.dir.version = FALSE,
  width = 90,
  max.print = 9999,
  knitr.table.format = "html",
  crayon.enabled = TRUE
)
```

---
layout: true
# åº”ç”¨åœºæ™¯
---

ç ”ç©¶æŸç§è¯ç‰©çš„ç–—æ•ˆï¼Œä¸€èˆ¬é‡‡ç”¨**å¤§æ ·æœ¬éšæœºåŒç›²å¯¹ç…§è¯•éªŒ**ï¼Œ**æ¯”è¾ƒ**åœ¨ç‰¹å®šæ¡ä»¶ä¸‹è¢«è¯•çš„ååº”ï¼Œè·å–ç›¸å…³æ•°æ®åï¼Œä¼šè¿›è¡Œ.red[ç»„å†…æ¯”è¾ƒ]æˆ–è€….red[ç»„é—´æ¯”è¾ƒ]ï¼š

- .red[ç»„å†…æ¯”è¾ƒ]ï¼Œ åŒä¸€ç»„äººï¼Œæ¯ä¸ªäººè¦å®Œæˆå¤šæ¬¡æµ‹é‡ï¼ˆé‡å¤æµ‹é‡ï¼‰ï¼Œæ¯”å¦‚æœè¯ç¬¬ä¸€å¤©çš„æƒ…å†µï¼Œæœè¯ç¬¬äºŒå¤©çš„æƒ…å†µï¼Œæœè¯ç¬¬ä¸‰å¤©çš„æƒ…å†µ...ï¼Œæ¯ç»„çš„äººæ•°æ˜¯æ’å®šçš„ã€‚

- .red[ç»„é—´æ¯”è¾ƒ]ï¼Œ`A`ç»„çš„è¢«è¯•åƒ1mgï¼Œ`B`ç»„è¢«è¯•åƒ2mg, `C`ç»„åƒ3mg...ï¼Œæ¯ç»„çš„äººæ•°ä¸è¦æ±‚æ˜¯æ’å®šçš„ã€‚


--

.pull-left[
<br>

 è¿™ä¸ªè¿‡ç¨‹å¯èƒ½ä¼šä½¿ç”¨âœ

âœ…  Tæ£€éªŒ t.test<br>
âœ…  æ–¹å·®åˆ†æ ANOVA (ANalysis Of VAriance)<br>

]


.pull-right[

```{r echo=FALSE, out.width = '50%', fig.pos= "center", dpi = 300}
knitr::include_graphics("images/anova.jfif")
```
]



---
layout: false
class: inverse, center, middle
# ä»ä¸€ä¸ªæ¡ˆä¾‹å¼€å§‹


---
layout: true
# è±šé¼ çš„ç‰™é½¿
---

.pull-left[
è¿™ä¸ªæ•°æ®é›†è®°å½•ç€ 60 åª.red[è±šé¼ ]åœ¨ä¸åŒçš„æ‘„å…¥æ–¹æ³•å’Œä¸åŒç»´ç”Ÿç´ å‰‚é‡ä¸‹ï¼Œç‰™é½¿çš„ç”Ÿé•¿æƒ…å†µ

- length : ç‰™é½¿é•¿åº¦
- supp   : ä¸¤ç§æ‘„å…¥æ–¹æ³• (æ©™æ±å’Œç»´ç”Ÿç´ ç‰‡)
- dose   : ç»´ç”Ÿç´ å‰‚é‡ (0.5, 1, and 2 mg/day) 

]


.pull-right[

```{r echo=FALSE, out.width = '100%', fig.pos= "center", dpi = 300}
knitr::include_graphics("images/guinea_pigs.png")
```
]



---
layout: true
# è±šé¼ çš„ç‰™é½¿ç”Ÿé•¿
---


.pull-left[

è¯»å…¥æ•°æ®
```{r message=FALSE, warning=FALSE}
library(tidyverse)

ToothGrowth <- 
  read_csv("./data/ToothGrowth.csv") %>% 
  mutate(
    across(c(dose, supp), as.factor)
  )
```

]

--

.pull-right[

æ•°æ®é•¿æˆè¿™ä¸ªæ ·å­

```{r, echo = FALSE}
ToothGrowth %>% 
  head(12) %>% 
  knitr::kable() 
```

]



---
layout: false
class: inverse, center, middle
# é—®é¢˜ä¸€ï¼šå–æ©™æ± vs åƒè¯ç‰‡ï¼Œè°çš„ç‰™é½¿é•¿ï¼Ÿ


---
layout: true
# å…ˆç”»å›¾çœ‹çœ‹
---

```{r, fig.asp = 0.8, out.width= "45%", dpi = 300}
ToothGrowth %>%
  ggplot(aes(x = supp, y = length)) +
  geom_point() #<<
```

---
layout: true
# å…ˆç”»å›¾çœ‹çœ‹
---

```{r, fig.asp = 0.8, out.width= "45%", dpi = 300}
ToothGrowth %>%
  ggplot(aes(x = length)) +
  geom_density(aes(color = supp))  #<<
```

---
layout: true
# å…ˆç”»å›¾çœ‹çœ‹
---

```{r, fig.asp = 0.8, out.width= "45%", dpi = 300}
ToothGrowth %>%
  ggplot(aes(x = supp, y = length)) +
  geom_boxplot(alpha = 0.3)    #<<
```


---
layout: true
# å…ˆç”»å›¾çœ‹çœ‹
---

```{r, fig.asp = 0.8, out.width= "45%", dpi = 300}
ToothGrowth %>%
  ggplot(aes(x = supp, y = length)) +
  geom_boxplot(alpha = 0.3) +   
  geom_jitter()                 #<<
```




---
layout: true
# è®¡ç®—ä¸¤ç§æ‘„å…¥æ–¹æ³•ä¸‹ï¼Œç‰™é½¿é•¿åº¦çš„å‡å€¼
---

åˆ†ç»„ç»Ÿè®¡å‡å€¼ï¼Œç¬¬ä¸€æ­¥

.pull-left[
```{r, eval=FALSE}
ToothGrowth %>% 
  group_by(supp) #<<
```
]


.pull-right[

```{r echo=FALSE, out.width = '100%', fig.pos= "center", dpi = 300}
knitr::include_graphics("images/group_by.png")
```
]


---
layout: true
# è®¡ç®—ä¸¤ç§æ‘„å…¥æ–¹æ³•ä¸‹ï¼Œç‰™é½¿é•¿åº¦çš„å‡å€¼
---

åˆ†ç»„ç»Ÿè®¡å‡å€¼ï¼Œç¬¬äºŒæ­¥

.pull-left[
```{r, eval=FALSE}
ToothGrowth %>% 
  group_by(supp) %>% 
  summarise(
    mean_length = mean(length) #<<
  )
```
]


.pull-right[

```{r echo=FALSE, out.width = '100%', fig.pos= "center", dpi = 300}
knitr::include_graphics("images/summarise.png")
```
]


---
layout: true
# è®¡ç®—ä¸¤ç§æ‘„å…¥æ–¹æ³•ä¸‹ï¼Œç‰™é½¿é•¿åº¦çš„å‡å€¼
---

```{r}
ToothGrowth %>% 
  group_by(supp) %>% 
  summarise(
    mean_length = mean(length)
  ) %>% 
  knitr::kable() 
```



---
layout: true
# å–æ©™æ±çš„è±šé¼ æ¯”åƒç»´ç”Ÿç´ ç‰‡çš„ç‰™é½¿è¦é•¿ï¼Ÿ
---

--

ä»ç»Ÿè®¡å­¦è§’åº¦å›ç­”ï¼Œ.blue[åŒæ ·æœ¬Tæ£€éªŒ](è¿™é‡Œsuppçš„å±‚çº§åªæœ‰2å±‚)æˆ–è€….blue[å•å› ç´ æ–¹å·®åˆ†æ]éƒ½æ˜¯å¯ä»¥çš„

--

```{r, eval=FALSE}
t.test(length ~ supp, data = ToothGrowth) #<<
```

--
```{r, echo=FALSE}
t.test(length ~ supp, data = ToothGrowth)
```

--
.content-box-purple[
è™½ç„¶å–æ©™å­çš„å‡å€¼è¦é«˜äºåƒè¯ç‰‡çš„ï¼Œä½†è¿™é‡Œpå€¼0.06 > 0.05ï¼Œè€Œä¸”95%ç½®ä¿¡åŒºé—´åŒ…å«äº† 0ï¼Œæ‰€ä»¥ä»ä¸Šè¿°å‡è®¾æ¨¡å‹æ¥çœ‹ï¼Œä¸èƒ½è¯´æ˜å–æ©™æ±çš„è±šé¼ ä¸€å®šæ¯”åƒç»´ç”Ÿç´ ç‰‡çš„ç‰™é½¿è¦é•¿ã€‚
]




---
layout: true
# Tæ£€éªŒæœ¬è´¨ä¸Šæ˜¯çº¿æ€§å›å½’
---

```{r, fig.asp= 0.8, out.width= "40%", dpi = 300}
ToothGrowth %>%
  mutate(supp = if_else(supp == "VC", 1, 2)) %>%
  ggplot(aes(x = supp, y = length)) +
  geom_point() +
  stat_summary(
   fun = mean,
   geom = "point",
   color = "red",
   size = 3
  ) +
  geom_smooth(method = "lm") #<<
```



---
layout: true
# Tæ£€éªŒæœ¬è´¨ä¸Šæ˜¯çº¿æ€§å›å½’
---

.pull-left[

ä½¿ç”¨ `t.test()`
```{r}
t.test(length ~ supp, data = ToothGrowth) #<<
```

]


.pull-right[

ä½¿ç”¨ `lm()`
```{r}
tbl <- ToothGrowth %>% 
  mutate(supp = fct_rev(supp))


model <- lm(length ~ supp, data = tbl) #<<

confint(model)
```

<br>
å¯ä»¥çœ‹åˆ°ï¼Œ95%çš„ç½®ä¿¡åŒºé—´ä¸ç”¨`t.test()`çš„ç»“æœä¸€è‡´ã€‚

]




---
layout: true
# çœ‹ä¸“å®¶æ€ä¹ˆè¯´`r emo::ji("pencil")`
---

--

ä»[CRAN](https://github.com/easystats/report)ä¸Šå®‰è£…å®åŒ…`report` 

```{r, eval=FALSE}
install.packages("report")
```

--

```{r, eval=FALSE}
library(report)    
mod1 <- t.test(length ~ supp, data = ToothGrowth)

report(mod1)
```


.content-box-green[

Effect sizes were labelled following Cohen's (1988) recommendations.

The Welch Two Sample t-test testing the difference of length by supp (mean in group OJ = 20.66, mean in group VC = 16.96) suggests that the effect is positive, statistically not significant, and medium (difference = 3.70, 95% CI [-0.17, 7.57], t(55.31) = 1.92, p = 0.061; Cohen's d = 0.52, 95% CI [-0.02, 1.05])

]



---
layout: true
# æ¨è ggstatsplot ğŸ‘

---


--

ä»[CRAN](https://cran.r-project.org/web/packages/ggstatsplot/index.html)ä¸Šå®‰è£…å®åŒ…`ggstatsplot` 

```{r, eval=FALSE}
install.packages("ggstatsplot")
```

--

ä¹Ÿå¯ä»¥ä»[Github](https://github.com/IndrajeetPatil/ggstatsplot)å®‰è£…å®ƒçš„å¼€å‘ç‰ˆæœ¬

```{r, eval=FALSE}
remotes::install_github("IndrajeetPatil/ggstatsplot")
```

--

ä½¿ç”¨è¯¥å®åŒ…

```{r, eval=TRUE, warning=FALSE}
library(ggstatsplot)
library(ggplot2)
```


---
layout: true
# ggbetweenstats() ç»„é—´æ¯”è¾ƒ
---

--

.left-code[
```{r ggbetweenstats_1, eval=FALSE}
library(ggstatsplot)
ggbetweenstats(
  data = ToothGrowth,
  x = supp,
  y = length
)
```

.font70[
Function internally decides tests

- *t*-test if `2` groups
- ANOVA if `> 2` groups

`r emo::ji("pencil")` .blue[Defaults] return <br>

âœ… raw data + distributions <br>
âœ… descriptive statistics <br>
âœ… inferential statistics <br>
âœ… effect size + CIs <br>
âœ… pairwise comparisons <br>
âœ… Bayesian hypothesis-testing <br>
âœ… Bayesian estimation
]

]

--

.right-plot[
```{r ggbetweenstats_1_callout, ref.label='ggbetweenstats_1', echo=FALSE}
```
]



---
layout: true
# ç»Ÿè®¡å«ä¹‰ ğŸ†
---

```{r echo=FALSE, out.width = '100%', fig.pos= "center"}
knitr::include_graphics("images/stats_reporting_format.png")
```


---
layout: false
class: inverse, center, middle
# é—®é¢˜äºŒï¼šç»´ç”Ÿç´ æ‘„å…¥å‰‚é‡å¯¹è±šé¼ ç‰™é½¿ç”Ÿé•¿æ˜¯å¦å­˜åœ¨æ˜¾è‘—å½±å“ï¼Ÿ



---
layout: true
# å…ˆç”»å›¾çœ‹çœ‹
---

```{r, fig.asp = 0.8, out.width= "45%", dpi = 300}
ToothGrowth %>%
  ggplot(aes(x = dose, y = length)) +
  geom_boxplot(alpha = 0.3) +   
  geom_jitter()   
```



---
layout: true
# è®¡ç®—ä¸åŒæ‘„å…¥å‰‚é‡ä¸‹ï¼Œç‰™é½¿é•¿åº¦çš„å‡å€¼
---

```{r}
ToothGrowth %>% 
  group_by(dose) %>% 
  summarise(
    mean_length = mean(length)
  ) %>% 
  knitr::kable() 
```


---
layout: true
# è®¡ç®—ä¸åŒæ‘„å…¥å‰‚é‡ä¸‹ï¼Œç‰™é½¿é•¿åº¦çš„æ˜¾è‘—ä¸åŒï¼Ÿ
---


--

`r emo::ji("x")` T æ£€éªŒ
```{r, error=TRUE}
t.test(length ~ dose, data = ToothGrowth) #<<
```


--

âœ…  å•å› ç´ æ–¹å·®åˆ†æ


```{r}
aov(length ~ dose, data = ToothGrowth) %>%  #<<
  summary()
```




---
layout: true
# ç»„é—´æ¯”è¾ƒ
---


--

.left-code[
```{r ggbetweenstats_2, eval=FALSE}
library(ggstatsplot)

ggbetweenstats(
  data = ToothGrowth,
  x = dose,   #<<
  y = length
)
```
]

--

.right-plot[
```{r ggbetweenstats_2_callout, ref.label='ggbetweenstats_2', echo=FALSE}
```
]






---
layout: false
class: inverse, center, middle
# é—®é¢˜ä¸‰ï¼šç»´ç”Ÿç´ æ‘„å…¥æ–¹æ³•å’Œå‰‚é‡å¯¹è±šé¼ ç‰™é½¿ç”Ÿé•¿æ˜¯å¦å­˜åœ¨æ˜¾è‘—å½±å“ï¼Ÿ



---
layout: true
# åˆ†ç»„ç”»å›¾çœ‹çœ‹
---

```{r, fig.asp= 0.65, out.width= "55%", dpi = 300}
ToothGrowth %>%
  ggplot(aes(x = supp, y = length, fill = supp)) +
  geom_boxplot() +
  facet_wrap(vars(dose)) +
  labs(title = "ç»´ç”Ÿç´ æ‘„å…¥æ–¹æ³•å’Œå‰‚é‡å¯¹è±šé¼ ç‰™é½¿ç”Ÿé•¿çš„å½±å“")
```


---
layout: true
# åˆ†ç»„ç»Ÿè®¡å‡å€¼ï¼Œç¬¬ä¸€æ­¥
---

.pull-left[
```{r, eval=FALSE}
ToothGrowth %>% 
  group_by(supp, dose) #<<
```
]


.pull-right[

```{r echo=FALSE, out.width = '100%', fig.pos= "center"}
knitr::include_graphics("images/group_by2.png")
```
]


---
layout: true
# åˆ†ç»„ç»Ÿè®¡å‡å€¼ï¼Œç¬¬äºŒæ­¥
---

.pull-left[
```{r, eval=FALSE}
ToothGrowth %>% 
  group_by(supp, dose) %>% 
  summarise(
    mean_length = mean(length)  #<<
  )
```
]


.pull-right[

```{r echo=FALSE, out.width = '100%', fig.pos= "center"}
knitr::include_graphics("images/summarise2.png")
```
]



---
layout: true
# ä¸åŒæ‘„å…¥æ–¹æ³•å’Œä¸åŒæ‘„å…¥å‰‚é‡ä¸‹ï¼Œç‰™é½¿é•¿åº¦çš„å‡å€¼
---

```{r}
ToothGrowth %>% 
  group_by(supp, dose) %>% 
  summarise(
    mean_length = mean(length)
  ) %>% 
  knitr::kable() 
```




---
layout: true
# æ‘„å…¥æ–¹æ³•å’Œå‰‚é‡ï¼Œå¯¹è±šé¼ ç‰™é½¿ç”Ÿé•¿æ˜¯å¦å­˜åœ¨æ˜¾è‘—å½±å“ï¼Ÿ
---


--

è¿™é‡Œæ˜¯ä¸¤ä¸ªè§£é‡Šå˜é‡ï¼Œæ‰€ä»¥éœ€è¦åŒå› ç´ æ–¹å·®åˆ†æ (ANOVA)

--

```{r}
aov(length ~ supp + dose, data = ToothGrowth) %>% #<<
  summary()
```

--

<br>
.content-box-green[
è¡¨æ˜æ‘„å…¥æ–¹æ³•ã€æ‘„å…¥å‰‚é‡å¯¹ç‰™é½¿é•¿åº¦çš„å½±å“éƒ½æ˜¯æ˜¾è‘—çš„ã€‚
]


---
layout: true
# çœ‹ä¸“å®¶æ€ä¹ˆè¯´
---


```{r, eval=FALSE}
library(report)
mod2 <- aov(length ~ supp + dose, data = ToothGrowth)

report(mod2)
```

.content-box-red[

The ANOVA (formula: length ~ supp + dose) suggests that:

  - The main effect of supp is statistically significant and large (F(1, 56) = 14.02, p < .001; Eta2 (partial) = 0.20, 95% CI [0.07, 1.00])
  - The main effect of dose is statistically significant and large (F(2, 56) = 82.81, p < .001; Eta2 (partial) = 0.75, 95% CI [0.65, 1.00])

Effect sizes were labelled following Field's (2013) recommendations.

]




---
layout: false

class: inverse, center, middle

# é—®é¢˜å››ï¼šåœ¨ä¸åŒå‰‚é‡ä¸‹ï¼Œä¸¤ç§æ‘„å…¥æ–¹æ³•å¯¹ç»“æœæ˜¯å¦å­˜åœ¨æ˜¾è‘—å½±å“ï¼Ÿ




---
layout: true
# ä¸åŒå‰‚é‡ä¸‹ï¼Œæ‘„å…¥æ–¹æ³•å¯¹ç»“æœæ˜¯å¦å­˜åœ¨æ˜¾è‘—å½±å“ï¼Ÿ
---

```{r, fig.asp = 0.8, out.width= "45%", dpi = 300}
ToothGrowth %>%
  ggplot(aes(x = dose, y = length, color = supp)) +
  geom_boxplot(alpha = 0.3, position = position_dodge(0.8)) +
  geom_jitter(position = position_jitterdodge(dodge.width = 0.8) ) +
  theme_classic()
```



---
layout: true
# ä¸åŒå‰‚é‡ä¸‹ï¼Œæ‘„å…¥æ–¹æ³•å¯¹ç»“æœæ˜¯å¦å­˜åœ¨æ˜¾è‘—å½±å“ï¼Ÿ
---

ä½¿ç”¨ `tidyverse` æ–¹æ³•

```{r}
ToothGrowth %>%
  group_by(dose) %>%
  group_modify(
    ~ t.test(length ~ supp, data = .x) %>%
      broom::tidy()
  ) %>% 
  select(1:9) %>% 
  knitr::kable()
```

---
layout: true
# ä¸åŒå‰‚é‡ä¸‹ï¼Œæ‘„å…¥æ–¹æ³•å¯¹ç»“æœæ˜¯å¦å­˜åœ¨æ˜¾è‘—å½±å“ï¼Ÿ
---

ä½¿ç”¨ `rstatix::t_test()` æ–¹æ³•

```{r}
library(rstatix)
ToothGrowth %>%
  group_by(dose) %>%
  rstatix::t_test(length ~ supp) %>% 
  knitr::kable()
```


---
layout: true
# ä¸åŒå‰‚é‡ä¸‹ï¼Œæ‘„å…¥æ–¹æ³•å¯¹ç»“æœæ˜¯å¦å­˜åœ¨æ˜¾è‘—å½±å“ï¼Ÿ
---

ä½¿ç”¨ `ggstatsplot()` å®åŒ…

```{r ggbetweenstats_3, eval=FALSE}
ToothGrowth %>% 
  ggstatsplot::grouped_ggbetweenstats(
    x = supp,
    y = length,
    grouping.var = dose,   #<<
    pairwise.display = "all"
  )
```



---
layout: true
# ä¸åŒå‰‚é‡ä¸‹ï¼Œæ‘„å…¥æ–¹æ³•å¯¹ç»“æœæ˜¯å¦å­˜åœ¨æ˜¾è‘—å½±å“ï¼Ÿ
---

```{r ggbetweenstats_3_callout, ref.label='ggbetweenstats_3', echo=FALSE, out.height = "100%", fig.width  = 12, fig.height = 6, out.width= "100%", dpi=600}
```




---
layout: false
class: inverse, center, middle

# æ„Ÿè°¢ R è¯­è¨€ä¹‹ç¾!

æœ¬å¹»ç¯ç‰‡ç”± R åŒ… [xaringan](https://github.com/yihui/xaringan) å’Œ [flipbookr](https://github.com/EvaMaeRey/flipbookr) ç”Ÿæˆ ğŸ™Œ


